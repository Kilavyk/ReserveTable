<!-- templates/Bookings/booking_detail.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #{{ booking.id }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <style>


    </style>
</head>
<body>
{% include 'includes/header.html' %}

<div class="container mt-4" style="max-width: 1000px;"
">
<!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'bookings:admin_panel' %}">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a></li>
        <li class="breadcrumb-item active">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #{{ booking.id }}</li>
    </ol>
</nav>

<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
<div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded">
    <div class="d-flex align-items-center">
        <h1 class="h3 mb-0 me-3">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #{{ booking.id }}</h1>
        <span class="badge
                    {% if booking.status == 'confirmed' %}bg-success
                    {% elif booking.status == 'pending' %}bg-warning text-dark
                    {% else %}bg-danger{% endif %}">
                    {{ booking.get_status_display }}
                </span>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    {% if not booking.is_past %}
    <div class="d-flex align-items-center">
        <form method="post" class="d-flex">
            {% csrf_token %}
            {% if can_confirm %}
            <button type="submit" name="action" value="confirm" class="btn btn-success action-btn">
                –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
            </button>
            {% endif %}

            {% if can_cancel %}
            <button type="submit" name="action" value="cancel" class="btn btn-danger action-btn">
                –û—Ç–º–µ–Ω–∏—Ç—å
            </button>
            {% endif %}
        </form>
        <a href="{% url 'bookings:admin_panel' %}?date={{ booking.booking_date|date:'Y-m-d' }}"
           class="btn btn-outline-secondary action-btn ms-2">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
    </div>
    {% else %}
    <div class="d-flex align-items-center">
        <span class="text-muted me-3">–ü—Ä–æ—à–µ–¥—à–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
        <a href="{% url 'bookings:admin_panel' %}?date={{ booking.booking_date|date:'Y-m-d' }}"
           class="btn btn-outline-secondary action-btn">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
    </div>
    {% endif %}
</div>

<!-- –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
<div class="row">
    <!-- –ö–æ–ª–æ–Ω–∫–∞ 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–ª–∏–∫–µ -->
    <div class="col-md-6 mb-4">
        <div class="card  h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</h5>
            </div>
            <div class="card-body">
                <div class="list-group-item">
                    <strong>–°—Ç–æ–ª–∏–∫:</strong>
                    <span class="float-end">
                                <strong>‚Ññ{{ booking.table.number }}</strong>
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–î–∞—Ç–∞:</strong>
                    <span class="float-end">
                                {{ booking.booking_date|date:"d.m.Y" }}<br>

                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–í—Ä–µ–º—è:</strong>
                    <span class="float-end">
                                {{ booking.get_time_slot_display }}<br>

                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π:</strong>
                    <span class="float-end">
                                <span>{{ booking.guests_count }} —á–µ–ª–æ–≤–µ–∫</span>
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ç–æ–ª–∏–∫–∞:</strong>
                    <span class="float-end">
                                –¥–æ {{ booking.table.max_guests }} –≥–æ—Å—Ç–µ–π
                            </span>
                </div>


                <div class="list-group-item">
                    <strong>–°–æ–∑–¥–∞–Ω–æ:</strong>
                    <span class="float-end">
                                {{ booking.created_at|date:"d.m.Y H:i" }}
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong>
                    <span class="float-end">
                                {{ booking.updated_at|date:"d.m.Y H:i" }}
                            </span>
                </div>

                {% if booking.table.description %}
                <div class="list-group-item">
                    <strong>–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–∞:</strong>
                    <span class="float-end text-end">
                                <small class="text-muted">{{ booking.table.description }}</small>
                            </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ö–æ–ª–æ–Ω–∫–∞ 2: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h5>
            </div>
            <div class="card-body">
                <div class="list-group-item">
                    <strong>–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è:</strong>
                    <span class="float-end">
                                {% if booking.user.get_full_name %}
                                    {{ booking.user.get_full_name }}
                                {% else %}
                                    <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                {% endif %}
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>Email:</strong>
                    <span class="float-end">
                                {{ booking.user.email }}
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong>
                    <span class="float-end">
                                {% if booking.user.phone_number %}
                                    {{ booking.user.phone_number }}
                                {% else %}
                                    <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong>
                    <span class="float-end">
                                <code>#{{ booking.user.id }}</code>
                            </span>
                </div>

                <div class="list-group-item">
                    <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong>
                    <span class="float-end">
                    {{ booking.user.date_joined|date:"d.m.Y H:i" }}
                     </span>
                </div>

                <div class="list-group-item">
                    <strong>–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞:</strong>
                    <span class="float-end">
                                {% if booking.user.is_active %}
                                    <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                                {% else %}
                                    <span>–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                {% endif %}
                            </span>
                </div>

                {% if booking.user.photo %}
                <div class="list-group-item">
                    <strong>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è:</strong>
                    <span class="float-end">
                                <img src="{{ booking.user.photo.url }}"
                                     alt="–§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                     class="rounded-circle"
                                     style="width: 50px; height: 50px; object-fit: cover;">
                            </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è -->
{% if booking.special_requests %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</h5>
            </div>
            <div class="card-body">

                <p class="mb-0">{{ booking.special_requests }}</p>

            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
{% if not booking.is_past %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6>üí° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h6>
            <p class="mb-0 small">
                {% if booking.status == 'pending' %}
                –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –µ–≥–æ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å.
                {% elif booking.status == 'confirmed' %}
                –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –µ–≥–æ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.
                {% elif booking.status == 'cancelled' %}
                –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ.
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endif %}


<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript -->
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

<script>
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
    document.addEventListener('DOMContentLoaded', function() {
        const confirmBtn = document.querySelector('button[value="confirm"]');
        const cancelBtn = document.querySelector('button[value="cancel"]');

        if (confirmBtn) {
            confirmBtn.addEventListener('click', function(e) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')) {
                    e.preventDefault();
                }
            });
        }

        if (cancelBtn) {
            cancelBtn.addEventListener('click', function(e) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ? –ö–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω.')) {
                    e.preventDefault();
                }
            });
        }
    });
</script>
</body>
</html>